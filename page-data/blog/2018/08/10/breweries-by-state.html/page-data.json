{"componentChunkName":"component---src-templates-blog-js","path":"/blog/2018/08/10/breweries-by-state.html","result":{"data":{"markdownRemark":{"id":"ed0f6b82-14eb-5cc8-bcab-21c120166b0d","html":"<table>\n<thead>\n<tr>\n<th align=\"center\"><strong>City</strong></th>\n<th align=\"center\"><strong>State</strong></th>\n<th align=\"center\"><strong>Count</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align=\"center\">Portland</td>\n<td align=\"center\">Oregon</td>\n<td align=\"center\">80</td>\n</tr>\n<tr>\n<td align=\"center\">Denver</td>\n<td align=\"center\">Colorado</td>\n<td align=\"center\">77</td>\n</tr>\n<tr>\n<td align=\"center\">San Diego</td>\n<td align=\"center\">California</td>\n<td align=\"center\">74</td>\n</tr>\n<tr>\n<td align=\"center\">Chicago</td>\n<td align=\"center\">Illinois</td>\n<td align=\"center\">69</td>\n</tr>\n<tr>\n<td align=\"center\">Seattle</td>\n<td align=\"center\">Washington</td>\n<td align=\"center\">67</td>\n</tr>\n<tr>\n<td align=\"center\">Austin</td>\n<td align=\"center\">Texas</td>\n<td align=\"center\">43</td>\n</tr>\n<tr>\n<td align=\"center\">Albuquerque</td>\n<td align=\"center\">New Mexico</td>\n<td align=\"center\">40</td>\n</tr>\n<tr>\n<td align=\"center\">San Francisco</td>\n<td align=\"center\">California</td>\n<td align=\"center\">37</td>\n</tr>\n<tr>\n<td align=\"center\">Minneapolis</td>\n<td align=\"center\">Minnesota</td>\n<td align=\"center\">36</td>\n</tr>\n<tr>\n<td align=\"center\">Indianapolis</td>\n<td align=\"center\">Indiana</td>\n<td align=\"center\">35</td>\n</tr>\n<tr>\n<td align=\"center\">Asheville</td>\n<td align=\"center\">North Carolina</td>\n<td align=\"center\">30</td>\n</tr>\n<tr>\n<td align=\"center\">Los Angeles</td>\n<td align=\"center\">California</td>\n<td align=\"center\">29</td>\n</tr>\n<tr>\n<td align=\"center\">Milwaukee</td>\n<td align=\"center\">Wisconsin</td>\n<td align=\"center\">28</td>\n</tr>\n<tr>\n<td align=\"center\">Brooklyn</td>\n<td align=\"center\">New York</td>\n<td align=\"center\">26</td>\n</tr>\n<tr>\n<td align=\"center\">Saint Louis</td>\n<td align=\"center\">Missouri</td>\n<td align=\"center\">26</td>\n</tr>\n<tr>\n<td align=\"center\">Cincinnati</td>\n<td align=\"center\">Ohio</td>\n<td align=\"center\">26</td>\n</tr>\n<tr>\n<td align=\"center\">Nashville</td>\n<td align=\"center\">Tennessee</td>\n<td align=\"center\">25</td>\n</tr>\n<tr>\n<td align=\"center\">Columbus</td>\n<td align=\"center\">Ohio</td>\n<td align=\"center\">25</td>\n</tr>\n<tr>\n<td align=\"center\">Colorado Springs</td>\n<td align=\"center\">Colorado</td>\n<td align=\"center\">25</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<p>I was recently having a discussion with a friend about which city had the most breweries. I couldn't find anything on the internet that was able to answer that simple question. I decided to use this as an opportuntity for a little project. </p>\n<h2 id=\"gather-data\" style=\"position:relative;\"><a href=\"#gather-data\" aria-label=\"gather data permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gather Data</h2>\n<p>I decided to use BeerAdvocate as my source. I was almost certain there was an API for BeerAdvocate, but there wasn't, so I had to scrap their listings page, which was easy enough.</p>\n<p>I saved off the HTML files, so I didn't have to scrape more than I needed to.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">for</span> p <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1510</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    params <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'start'</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span><span class=\"token operator\">*</span>p<span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'c_id'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'US'</span>\n    <span class=\"token punctuation\">}</span>\n    page <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'https://www.beeradvocate.com/place/list'</span><span class=\"token punctuation\">,</span> params<span class=\"token operator\">=</span>params<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'./beer_advocate/page_</span><span class=\"token interpolation\"><span class=\"token punctuation\">{</span>p<span class=\"token punctuation\">}</span></span><span class=\"token string\">.html'</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">'w'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> fid<span class=\"token punctuation\">:</span>\n        fid<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>I then used lxml and some xpath magic to pull the relevant data.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">get_name <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xpath<span class=\"token punctuation\">(</span><span class=\"token string\">'./td[1]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>text_content<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>get_name<span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nget_address <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xpath<span class=\"token punctuation\">(</span><span class=\"token string\">\"./td[1]/text()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>get_address<span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nget_zip <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xpath<span class=\"token punctuation\">(</span><span class=\"token string\">\"./td[1]/text()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">', '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>tryf<span class=\"token punctuation\">(</span>get_zip<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nget_city <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> <span class=\"token string\">\" \"</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xpath<span class=\"token punctuation\">(</span><span class=\"token string\">\"./td[1]/a[1]/text()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>tryf<span class=\"token punctuation\">(</span>get_city<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nget_state <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> <span class=\"token string\">\" \"</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xpath<span class=\"token punctuation\">(</span><span class=\"token string\">\"./td[1]/a[2]/text()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>tryf<span class=\"token punctuation\">(</span>get_state<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nget_country <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> <span class=\"token string\">\" \"</span><span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xpath<span class=\"token punctuation\">(</span><span class=\"token string\">\"./td[1]/a[3]/text()\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>tryf<span class=\"token punctuation\">(</span>get_country<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nget_score <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xpath<span class=\"token punctuation\">(</span><span class=\"token string\">'./td[2]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>text_content<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>tryf<span class=\"token punctuation\">(</span>get_score<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nget_ratings <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xpath<span class=\"token punctuation\">(</span><span class=\"token string\">'./td[3]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>text_content<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>tryf<span class=\"token punctuation\">(</span>get_ratings<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nget_beer_avg <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xpath<span class=\"token punctuation\">(</span><span class=\"token string\">'./td[4]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>text_content<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>tryf<span class=\"token punctuation\">(</span>get_beer_avg<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\nget_num_beers <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span> x<span class=\"token punctuation\">:</span> x<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>xpath<span class=\"token punctuation\">(</span><span class=\"token string\">'./td[5]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>text_content<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>tryf<span class=\"token punctuation\">(</span>get_num_beers<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>I then ran through all the files, pushing each brewery into a list and finally created a Pandas DataFrame.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">out <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">for</span> page_num <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1510</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    page <span class=\"token operator\">=</span> get_page<span class=\"token punctuation\">(</span>page_num<span class=\"token punctuation\">)</span>\n    places <span class=\"token operator\">=</span> get_places<span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> p <span class=\"token keyword\">in</span> places<span class=\"token punctuation\">:</span>\n        out<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            <span class=\"token string\">'name'</span><span class=\"token punctuation\">:</span> get_name<span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'address'</span><span class=\"token punctuation\">:</span> tryf<span class=\"token punctuation\">(</span>get_address<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'city'</span><span class=\"token punctuation\">:</span> tryf<span class=\"token punctuation\">(</span>get_city<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'state'</span><span class=\"token punctuation\">:</span> tryf<span class=\"token punctuation\">(</span>get_state<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'country'</span><span class=\"token punctuation\">:</span> tryf<span class=\"token punctuation\">(</span>get_country<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'zip'</span><span class=\"token punctuation\">:</span> tryf<span class=\"token punctuation\">(</span>get_zip<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'score'</span><span class=\"token punctuation\">:</span> get_score<span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'ratings'</span><span class=\"token punctuation\">:</span> get_ratings<span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'beer_avg'</span><span class=\"token punctuation\">:</span> get_beer_avg<span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">'num_beers'</span><span class=\"token punctuation\">:</span> get_num_beers<span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\ndf <span class=\"token operator\">=</span> pd<span class=\"token punctuation\">.</span>DataFrame<span class=\"token punctuation\">(</span>out<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Getting the top 30 beer cities was as easy as ...</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">df<span class=\"token punctuation\">[</span><span class=\"token punctuation\">(</span>df<span class=\"token punctuation\">.</span>num_beers <span class=\"token operator\">!=</span> <span class=\"token string\">'-'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>groupby<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'city'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'state'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sort_values<span class=\"token punctuation\">(</span>ascending<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">(</span><span class=\"token number\">30</span><span class=\"token punctuation\">)</span></code></pre></div>","excerpt":"City State Count Portland Oregon 80 Denver Colorado 77 San Diego California 74 Chicago Illinois 69 Seattle Washington 67 Austin Texas 43 Albuquerque New Mexico 40 San Francisco California 37 Minneapolis Minnesota 36 Indianapolis Indiana 35 Asheville North Carolina 30 Los Angeles California 29 Milwaukee Wisconsin 28 Brooklyn New York 26 Saint Louis Missouri 26 Cincinnati Ohio 26 Nashville Tennessee 25 Columbus Ohio 25 Colorado Springs Colorado 25 I was recently having a discussion with a friend…","frontmatter":{"title":"Which US cities have the most breweries?"},"fields":{"date":"August 10, 2018","path":"blog/2018-08-10-breweries-by-state.md","slug":"/blog/2018/08/10/breweries-by-state.html"}}},"pageContext":{"slug":"/blog/2018/08/10/breweries-by-state.html"}}}